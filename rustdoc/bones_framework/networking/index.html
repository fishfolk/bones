<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Networked multi-player plugin."><title>bones_framework::networking - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-c5d6553a23f1e5a6.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="bones_framework" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0 (eeb90cda1 2024-09-04)" data-channel="1.81.0" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../bones_framework/index.html">bones_framework</a><span class="version">0.4.0</span></h2></div><h2 class="location"><a href="#">Module networking</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#statics">Statics</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate bones_framework</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">bones_framework</a>::<wbr><a class="mod" href="#">networking</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/bones_framework/networking.rs.html#1-999">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Networked multi-player plugin.</p>
<p>Bones uses a Peer-to-Peer, rollback networking model built on <a href="https://github.com/gschup/ggrs">GGRS</a>.</p>
<p>Messages are serialized/deserialized to a binary representation using <a href="https://docs.rs/serde"><code>serde</code></a> and the <a href="https://docs.rs/postcard"><code>postcard</code></a>
crate.</p>
<p>The major facets of our networking are:</p>
<ul>
<li><strong><a href="#matchmaking">Matchmaking</a>:</strong> How we connect clients to each-other and start an network match.</li>
<li><strong><a href="#synchronization">Synchronization</a>:</strong> How we synchronize a network game between multiple players.</li>
</ul>
<h3 id="matchmaking"><a class="doc-anchor" href="#matchmaking">§</a>Matchmaking</h3>
<p>There are currently two different matchmaking strategies: <a href="online/index.html" title="mod bones_framework::networking::online"><code>online</code></a> and <a href="lan/index.html" title="mod bones_framework::networking::lan"><code>lan</code></a>. Both of those
modules contain their own matchmaker with docs on how it works. Eventually we will probably have
additional matchmakers for Steam and the browser.</p>
<p>Regardless of the matchmaker, the goal is to find a match and establish a connection to the other
players. Once a match is established, the matchmaker must provide an implementation of
<a href="trait.NetworkSocket.html" title="trait bones_framework::networking::NetworkSocket"><code>NetworkSocket</code></a> that may be used to send <a href="https://github.com/gschup/ggrs">GGRS</a>, reliable, and unreliable messages.</p>
<p>Each matchmaker is free to implement this socket with whatever networking transport they wish,
allowing the Steam matchmaker, for example, to use the steam networking library, and the browser
matchmaker to use <code>WebTransport</code> or <code>WebRTC</code>.</p>
<h3 id="synchronization"><a class="doc-anchor" href="#synchronization">§</a>Synchronization</h3>
<p>Match synchronization, as mentioned above, is accomplished with <a href="https://github.com/gschup/ggrs">GGRS</a>, wich is a re-imagining of
the <a href="https://github.com/pond3r/ggpo/tree/master">GGPO</a> network SDK.</p>
<p>The <a href="trait.NetworkSocket.html" title="trait bones_framework::networking::NetworkSocket"><code>NetworkSocket</code></a> trait, which matchmakers are required to implement for their sockets, is
required to return an implementation of GGRS’s <a href="https://docs.rs/ggrs/0.9.2/ggrs/trait.NonBlockingSocket.html"><code>NonBlockingSocket</code></a> trait, so that it can send it’s
unreliable messages. The exact method for sending these messages depends on the matchmaker.</p>
<p>The key requirement for rollback networking is:</p>
<ul>
<li>The synchronized game loop must be <strong>deterministic</strong>.</li>
<li>We must have the ability to <strong>snapshot</strong> and <strong>restore</strong> the game state.</li>
<li>We must be able to run up to 8 game simulation frames in 16ms ( to achieve a 60 FPS frame rate,
even in the case where we have to rollback and re-simulate ).</li>
</ul>
<p>The integration with GGRS is implemented by the <a href="struct.GgrsSessionRunner.html" title="struct bones_framework::networking::GgrsSessionRunner"><code>GgrsSessionRunner</code></a>.</p>
<h3 id="input"><a class="doc-anchor" href="#input">§</a>Input</h3>
<p><a href="struct.GgrsSessionRunner.html" title="struct bones_framework::networking::GgrsSessionRunner"><code>GgrsSessionRunner</code></a> is generic over a couple of input traits, some of which have associated types with other trait bounds. This provides an API for game to define their input collection, control mapping, etc to be used by bones in networking.</p>
<h3 id="development--debugging"><a class="doc-anchor" href="#development--debugging">§</a>Development &amp; Debugging</h3>
<p>Here are some tips for debugging networking features while developing.</p>
<h4 id="local-sync-test"><a class="doc-anchor" href="#local-sync-test">§</a>Local Sync Test</h4>
<p>It can be cumbersome to start a new networked match every time you need to troubleshoot some part of
the game that may not be rolling back or restoring properly. To help with this, you can run the game
with the <code>--sync-test-check-distance 7</code> to make the game test rolling back and forward 8 times every
frame as a test when starting a local game.</p>
<p>This allows you to test the rollback without having to connect to a server. If things start popping
around the map or having other weird behaviors that they don’t have without the sync-test mode, then
you know you have a rollback issue.</p>
<blockquote>
<p><strong>ℹ️ Note:</strong> Just because you <strong>don’t</strong> have an issue in sync test mode, doesn’t mean that there
is no determinism issues. You still have to test network games with multiple game instances. There
are some non-determinism issues that only exhibit themselves when restarting the game.</p>
</blockquote>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="input/index.html" title="mod bones_framework::networking::input">input</a></div><div class="desc docblock-short">Input traits required by networking. These traits are networking specific, either only used in networking,
or extending other traits from <a href="../input/index.html" title="mod bones_framework::input"><code>crate::input</code></a> for networking.</div></li><li><div class="item-name"><a class="mod" href="lan/index.html" title="mod bones_framework::networking::lan">lan</a></div><div class="desc docblock-short">LAN matchmaking and socket implementation.</div></li><li><div class="item-name"><a class="mod" href="online/index.html" title="mod bones_framework::networking::online">online</a></div><div class="desc docblock-short">Matchmaking</div></li><li><div class="item-name"><a class="mod" href="online_lobby/index.html" title="mod bones_framework::networking::online_lobby">online_lobby</a></div></li><li><div class="item-name"><a class="mod" href="online_matchmaking/index.html" title="mod bones_framework::networking::online_matchmaking">online_matchmaking</a></div></li><li><div class="item-name"><a class="mod" href="prelude/index.html" title="mod bones_framework::networking::prelude">prelude</a></div><div class="desc docblock-short">Module prelude.</div></li><li><div class="item-name"><a class="mod" href="proto/index.html" title="mod bones_framework::networking::proto">proto</a></div><div class="desc docblock-short">Serializable data types for network messages used by the game.</div></li><li><div class="item-name"><a class="mod" href="socket/index.html" title="mod bones_framework::networking::socket">socket</a></div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.DisconnectedPlayers.html" title="struct bones_framework::networking::DisconnectedPlayers">DisconnectedPlayers</a></div><div class="desc docblock-short">Resource tracking which players have been disconnected.
May not be in world if no disconnects.</div></li><li><div class="item-name"><a class="struct" href="struct.GameMessage.html" title="struct bones_framework::networking::GameMessage">GameMessage</a></div><div class="desc docblock-short">Wraps <a href="../external/ggrs/struct.Message.html" title="struct bones_framework::external::ggrs::Message"><code>ggrs::Message</code></a> with included <code>match_id</code>, used to determine if message received
from current match.</div></li><li><div class="item-name"><a class="struct" href="struct.GgrsConfig.html" title="struct bones_framework::networking::GgrsConfig">GgrsConfig</a></div><div class="desc docblock-short">The <a href="../external/ggrs/trait.Config.html" title="trait bones_framework::external::ggrs::Config"><code>ggrs::Config</code></a> implementation used by Jumpy.</div></li><li><div class="item-name"><a class="struct" href="struct.GgrsSessionRunner.html" title="struct bones_framework::networking::GgrsSessionRunner">GgrsSessionRunner</a></div><div class="desc docblock-short"><a href="../lib/trait.SessionRunner.html" title="trait bones_framework::lib::SessionRunner"><code>SessionRunner</code></a> implementation that uses <a href="../external/ggrs/index.html" title="mod bones_framework::external::ggrs"><code>ggrs</code></a> for network play.</div></li><li><div class="item-name"><a class="struct" href="struct.GgrsSessionRunnerInfo.html" title="struct bones_framework::networking::GgrsSessionRunnerInfo">GgrsSessionRunnerInfo</a></div><div class="desc docblock-short">The info required to create a <a href="struct.GgrsSessionRunner.html" title="struct bones_framework::networking::GgrsSessionRunner"><code>GgrsSessionRunner</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.NetworkMatchSocket.html" title="struct bones_framework::networking::NetworkMatchSocket">NetworkMatchSocket</a></div><div class="desc docblock-short">Resource containing the <a href="trait.NetworkSocket.html" title="trait bones_framework::networking::NetworkSocket"><code>NetworkSocket</code></a> implementation while there is a connection to a
network game.</div></li><li><div class="item-name"><a class="struct" href="struct.PlayerNetworkStats.html" title="struct bones_framework::networking::PlayerNetworkStats">PlayerNetworkStats</a></div><div class="desc docblock-short">A schema-compatible wrapper for ggrs <code>NetworkStats</code> struct contains networking stats.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.NetworkError.html" title="enum bones_framework::networking::NetworkError">NetworkError</a></div><div class="desc docblock-short">Possible errors returned by network loop.</div></li><li><div class="item-name"><a class="enum" href="enum.NetworkInputStatus.html" title="enum bones_framework::networking::NetworkInputStatus">NetworkInputStatus</a></div><div class="desc docblock-short">Indicates if input from networking is confirmed, predicted, or if player is disconnected.</div></li><li><div class="item-name"><a class="enum" href="enum.SocketTarget.html" title="enum bones_framework::networking::SocketTarget">SocketTarget</a></div><div class="desc docblock-short">The destination for a reliable network message.</div></li><li><div class="item-name"><a class="enum" href="enum.SyncingInfo.html" title="enum bones_framework::networking::SyncingInfo">SyncingInfo</a></div><div class="desc docblock-short">Resource updated each frame exposing syncing/networking information in the current session.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.NETWORK_FRAME_RATE_FACTOR.html" title="constant bones_framework::networking::NETWORK_FRAME_RATE_FACTOR">NETWORK_FRAME_RATE_FACTOR</a></div><div class="desc docblock-short">Muliplier for framerate that will be used when playing an online match.</div></li><li><div class="item-name"><a class="constant" href="constant.NETWORK_LOCAL_INPUT_DELAY_DEFAULT.html" title="constant bones_framework::networking::NETWORK_LOCAL_INPUT_DELAY_DEFAULT">NETWORK_LOCAL_INPUT_DELAY_DEFAULT</a></div><div class="desc docblock-short">Amount of frames GGRS will delay local input.</div></li><li><div class="item-name"><a class="constant" href="constant.NETWORK_MAX_PREDICTION_WINDOW_DEFAULT.html" title="constant bones_framework::networking::NETWORK_MAX_PREDICTION_WINDOW_DEFAULT">NETWORK_MAX_PREDICTION_WINDOW_DEFAULT</a></div><div class="desc docblock-short">Number of frames client may predict beyond confirmed frame before freezing and waiting
for inputs from other players. Default value if not specified in <a href="struct.GgrsSessionRunnerInfo.html" title="struct bones_framework::networking::GgrsSessionRunnerInfo"><code>GgrsSessionRunnerInfo</code></a>.</div></li></ul><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="static" href="static.RUNTIME.html" title="static bones_framework::networking::RUNTIME">RUNTIME</a></div><div class="desc docblock-short">Runtime, needed to execute network related calls.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.GgrsSocket.html" title="trait bones_framework::networking::GgrsSocket">GgrsSocket</a></div><div class="desc docblock-short">Automatically implemented for <a href="trait.NetworkSocket.html" title="trait bones_framework::networking::NetworkSocket"><code>NetworkSocket</code></a> + <a href="../external/ggrs/trait.NonBlockingSocket.html" title="trait bones_framework::external::ggrs::NonBlockingSocket"><code>ggrs::NonBlockingSocket&lt;usize&gt;</code></a>.</div></li><li><div class="item-name"><a class="trait" href="trait.NetworkSocket.html" title="trait bones_framework::networking::NetworkSocket">NetworkSocket</a></div><div class="desc docblock-short">Trait that must be implemented by socket connections establish by matchmakers.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.get_network_endpoint.html" title="fn bones_framework::networking::get_network_endpoint">get_network_endpoint</a></div><div class="desc docblock-short">Get the network endpoint used for all communications.</div></li></ul></section></div></main></body></html>